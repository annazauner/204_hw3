---
title: "ESM 204 Homework 3"
output: html_document
date: 'Anna Zauner, Kirsten White and Katherine Rosencrance'
---

```{r setup, include=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(thematic)
library(scales)
library(equatiomatic)
library(rootSolve)

```


## Introduction

```{r}
# Read in the data 
data1 <- read_csv(here("data","HW3_data.csv")) %>% 
  clean_names() %>% 
  select(-x1)
```


The Biden Administration’s “interim” value is $51 per metric ton of CO2. In this analysis, we consider the distributional consequences of a household electricity tax based on the Social Cost of Carbon (SCC) to address the climate change problem.

Assumptions:

1. Consumers can separated into two income groups: “high” and “low.” 

2. Price ($) and quantity (kWh) estimates of demand per month for the two groups. 

3. Initially, there is no tax on electricity consumption.

4. The current electricity price (without any taxes) is $.10 per kWh.

5. The marginal cost of producing a kWh of electricity is linear and has a price-intercept of 0.


### **Question #1**

Calculating MEC

Assumptions:

1. One kWh of electricity emits 0.85 pounds of CO2 

2. Interim value of $51 per metric ton of CO2 

```{r}
# PIVOT LONGER WIH INCOME AS VARIABLE 

data_long <- data1 %>% 
  pivot_longer(cols = c(q_low_kwh, q_high_kwh),
               names_to = 'income',
               values_to = 'kwh') %>% 
  mutate(income = case_when(income == 'q_low_kwh' ~ 'low',
                   income == 'q_high_kwh' ~ 'high'))

# RUN CALCULATION FOR MEC

price_ton <- 51

# METRIC TON UNIT CONVERSION

price_lb <- price_ton/2205

price_lb

# UNIT CONVERSION 0.85 to get MEC/kWh

price_kWh <- price_lb*0.85

price_kWh

```

Based on the calculations, the MEC per kWh of electricity is **0.0197**.


### **Question #2**

Calculating:

a. Aggregate monthly demand for electricity
b. Supply curve for electricity 
c. Benefit to consumers and producers under status quo
d. Environmental cost under status quo

**Low income demand** 

```{r}
# LM ESTIMATE FOR LOW INCOME

demand_low <- lm(price_cents ~ kwh, income =='low', 
                 data = data_long) 

demand_low
```

**High income demand**

```{r}

# LM ESTIMATE FOR HIGH INCOME

demand_high <- lm(price_cents ~ kwh, income =='high',
                  data = data_long) 

demand_high

```


**a. Aggregate monthly demand for electricity**

Sum high and low demand curves horizontally to get aggregate demand curve:

```{r}

# DEMAND AGG 

# need to rearrange the parameter to get Q(P)! 

# Qgg = Qlow(P) + Qlow(h) 

# Importantly, since they-intercepts are different, we know that Qagg(P) will have a kink. I include an ifelse() statement to take
# care of the kink.

# define a function to get demand

demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)}

demand_agg <- function(p){
  q <- demand(p, demand_low) + demand(p, demand_high)
  return(q)}

demand_agg(10)

# 536719.50 Kwh at $0.10

```

```{r}
# LM FROM VECTOR 
price = seq(0, 30, length.out = 100)
Qagg <- map(price, demand_agg) %>% 
  unlist()
agg_df<- tibble(Qagg = Qagg, price = price)
demand_agg_eq <- lm(price ~ Qagg, data = agg_df) 


# SWITCH Q ON ONE SIDE OF EQUATION
agg_slope <- demand_agg_eq$coefficients[2]
agg_int <- demand_agg_eq$coefficients[1]

agg_slope
agg_int

# AGG DEMAND FUNCTION is P = 29.78135 - 0.00004(Qagg) 
```

Demand function of the aggregate demand is:  **P = 29.78135 - 0.00004 (Qagg)** 

**b. Supply curve for electricity** 

Now we need to calculate the supply curve for electricity. We already know that the current price is $0.10/kWh. We also know the MC for electricity is linear with a 0 intercept. 

```{r}

#536,719.5 kWh @ $0.10 CALCULATED ABOVE, INTERCEPT IS 0 

Qo_kWh <- demand_agg(10)

supply_slope <- 10/Qo_kWh

Qo_kWh

supply_slope

# SUPPLY FUNCTION is P = 0.0000186Q
```

The supply function is: **P = 0.0000186Q**


**c. Benefit to consumers and producers under status quo**

From this, we can calculate consumer and producer surplus as well as environmental cost. 

```{r}
# CALC CONSUMER SURPLUS

cs_base <- 0.5*Qo_kWh*(0.298 - 0.10)

cs_base

# $53135.23

# CALC PRODUCER SURPLUS

ps_base <- 0.5*Qo_kWh*0.10

ps_base

# $26,835.97

```

- Consumer Benefit is calculated as **$53135.23**

- Producer Benefit is calculated as **$26835.97**


**d. Environmental cost under status quo**


```{r}
env_cost_base <- price_kWh*Qo_kWh

env_cost_base

# $10,551.83
```

Environmental Cost calculated as **$10551.83**


### **Question #3**

Calculating consumer benefit divided between "high" and "low" income consumers given total consumer surplus is $ 53135.23 at price of $0.10 per kWh. 


```{r}

#PLUG IN INTECEPT FROM LOW DEMAND CURVE TO CALCULATE TRIANGLE

cs_low <- 0.5*(.2337 - .10)*demand(10, demand_low)

cs_low

# $8,111.84 CS LOW INCOME

#PLUG IN INTECEPT FROM HIGH DEMAND CURVE TO CALCULATE TRIANGLE

cs_high <- 0.5*(.3161-.10)*demand(10, demand_high)

# $44,881.32 CS HIGH INCOME

cs_high
```

Consumer surplus for the high-income group **($`r round(cs_low, 0)`) ** is significantly larger than the consumer surplus for the low-income group **( $`r round(cs_high, 0)`)** 


### **Question #4**

Deriving the optimal electricity tax (cents per kWh) with interim SCC. 
Assumptions:
- Low income group experience disproportionate share of impacts from climate change
- Climate externality is borne entirely by "low" income group

Calculating effects of tax on:

a. Amount of electricity produced and consumed
b. Price of electricity
c. Welfare of "high" income consumers
d. Welfare of "low" income consumers
e. Power suppliers 
f. Total environmental damage
g. Tax revenue generated



```{r}
mpc_q <- function(p) {p/supply_slope} # MPC in terms of Q

# DEMAND FUNCTION WITH TAX (SOLVED IN #1 MEC = $0.01965986 -> 1.97 cents)

dem_tax <- function(p, model){
  q <- (p - (model$coefficients[[1]]-1.97))/model$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)
}
# AGG DEMAND FUNCTION w/ TAX
dem_agg_tax <- function(p){
  q <- dem_tax(p, demand_low) + dem_tax(p, demand_high)
  return(q)
}

# NEW EQUILIBRIUM 

uniroot(function(p)
  dem_agg_tax(p) - mpc_q(p),
        interval = c(0,20))

# a. Amount of electricity produced and consumed

# b. Price of electricity

#save new p
p_tax <- 9.31988

#generate new Q
q_tax <- dem_agg_tax(p_tax)

q_tax 


#c. Welfare of "high" income consumers

demand_high_tax <- dem_tax(p_tax, demand_high)
cs_high_tax <- (0.5 * (.3161 - 0.0197 - (p_tax/100)) * demand_high_tax) - (demand_high_tax * 0.0197)

cs_high_tax

#d. Welfare of "low" income consumers

cs_low_tax_og <- cs_low - env_cost_base
demand_low_tax <- demand(p_tax, demand_low)

# LOW INCOME REDUCE DAMAGE, TAX and INITIAL CS LOW
env_cost_tax <- price_kWh * q_tax
cs_low_tax <- (0.5 * (.2337 - 0.0197 - 0.0932) * demand_low_tax) - (demand_low_tax * 0.0197) - env_cost_tax

cs_low_tax


# e. Power suppliers 

# FIND NEW P FOR SUPPLIERS GIVEN Q*

q_tax <- dem_agg_tax(p_tax)

ps_tax <- 0.5*q_tax*0.0932

ps_tax

# f. Total environmental damage

# P* of MEC (0.0197) TIMES Q*

env_change <- env_cost_base - env_cost_tax

env_change

# g. Tax revenue generated

# P* TIMES Q*

tax_rev <- price_kWh*q_tax

tax_rev
```

**Optimal Electricity Tax:** $ `r round(price_kWh, 4)` 

a. Amount of electricity produced and consumed

New quantity of electricity: **$`r round(q_tax, 2)`**

b. Price of electricity

New equilibrium price of electricity:  **$`r round(p_tax, 3)`**

c. Welfare of "high" income consumers

Decreases to: **$`r round(cs_high_tax, 0)`**

d. Welfare of "low" income consumers 

Decrease to: **$`r round(cs_low_tax, 0)`**

e. Power suppliers surplus

Decrease to:  **$`r round(ps_tax, 0)`**

f. Total environmental damage

Decreases to: **$`r round(env_change, 0)`**

g. Tax revenue generated
 
Increase to: **$`r round(tax_rev, 0)`**

### **Question #5**

Assumptions:
- All tax revenue will be distributed to consumers in proportion to their pre-tax consumption
- True SCC may be much higher than $51 (range: $51, $75, $100, $125, $150 per metric ton of CO2)

Calculating effects of SCC-based electricity tax for:

a. Welfare of "high" income consumers
b. Welfare of "low" income consumers
c. Electricity producers


```{r}

# 1. Find different prices per kWh

#   Reminder: - 1 kWh of electricity = 0.85 lb CO2
#   1 metric ton = 2204.6 lbs. Thus 1 metric ton of CO2 is emitted    #   from 2204.6/0.85 = 2594 kWh of electricity

# $75/ton - 75/(2594) = $0.0289/kWh
# $100/ton - 100/(2594) = $0.0386/kWh
# $125/ton - 125/(2594) = $0.0482/kWh
# $150/ton - 150/(2594) = $0.0578/kWh

tax_51 <- 0.0197 # 1.97 dollars/kwh
tax_75 <- 0.0289 # 2.89 dollars/kwh
tax_100 <- 0.0386  # 3.86 dollars/kwh
tax_125 <- 0.0482  # 4.82 dollars/kwh
tax_150 <- 0.0578  # 5.78 dollars /kwh

tax_list <- c(0.0197, 0.0289, 0.0386, 0.0482, 0.0578) # list of tax at each SCC scenario

# How much do each income levels use out of the total? (% of total)
high_use_percentage <- demand(10, demand_high)/Qo_kWh #77%
low_use_percentage <- demand(10, demand_low)/Qo_kWh #23%


# a. Welfare to "high" income consumers
#     High = high income % of CS + pre tax rebate
#     (high) pre tax rebate = (q*high/q*high +q*low) x tax
pretax_rebate_high <- high_use_percentage * tax_rev
welfare_high_51 <- pretax_rebate_high + cs_high_tax

# b. Welfare to "low" income consumers
#     Low = CS + pre tax rebate - [MEC x q~]
#     (low) pre tax rebate = (q*low/q*high +q*low) x tax revenue (p~q~)
pretax_rebate_low <- low_use_percentage * tax_rev
welfare_low_51 <- pretax_rebate_low + cs_low_tax

welfare_high_51


welfare_low_51


```

SCC of $51:

a. Welfare of "high" income consumers

**$39599.45**


b. Welfare of "low" income consumers

**$-2420.92**

c. Electricity producers


SCC of $75:

a. Welfare of "high" income consumers




b. Welfare of "low" income consumers



c. Electricity producers


SCC of $100:


a. Welfare of "high" income consumers




b. Welfare of "low" income consumers



c. Electricity producers


SCC of $125:



a. Welfare of "high" income consumers




b. Welfare of "low" income consumers



c. Electricity producers


SCC of $150:



a. Welfare of "high" income consumers




b. Welfare of "low" income consumers



c. Electricity producers



### **Question #6**

Suppose the “high” income group has access to expensive home solar generation. This lowers
the electricity demand curve for the “high” income group by half (vertically). Under this new
demand:

a. What is total electricity consumption?

b. What is the total environmental externality?

c. What value of the electricity tax makes the total environmental damage the same as the
damage when solar panels are available to the high income group?


```{r}
#QUESTION 6 SET UP

# DEMAND FUNCTIONS w/ SOLAR AT 51
dem_high_solar <- function(p){
  q <- (p - (demand_high$coefficients[[1]]-1.97)/2)/demand_high$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)
}
dem_low_solar <- function(p){
  q <- (p - (demand_low$coefficients[[1]]-1.97))/demand_low$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)
}
# AGGREGATE DEMAND SOLAR
dem_agg_solar <- function(p){
  q <- dem_high_solar(p) + dem_low_solar(p)
  return(q)
}

# NEW EQUILIBRIUM PRCICE

mpc_slope <- (10/Qo_kWh)

mpc_q <- function(p) {p/mpc_slope}

uniroot(function(p)
  dem_agg_solar(p) - mpc_q(p),
        interval = c(0,20))
```



```{r eval = FALSE}

#a. What is total electricity consumption?

# Q OF ELECTRICITY CONSUMED

solar_electricity <- mpc_q(5.84)

solar_electricity

#b. What is the total environmental externality?

# TOTAL ENVIRO EXTERNAILITY (Q * MEC of 1.97 cents)

env_cost_solar <- mpc_q(5.84)*(0.0197)

env_cost_solar

#c. What value of the electricity tax makes the total environmental damage the same as the
#damage when solar panels are available to the high income group?

# SCC WHEN EQUAL TO SOLAR EQUATION FOR DAMAGE

solar_tax_final <- (.0197/(env_cost_solar/env_cost_tax))

solar_tax_final

```


- Quantity of electricity consumed: **313,444 kWh**
- Total cost of environmental damages: **$6174.85**
- Value of electricity tax: **$0.03**

